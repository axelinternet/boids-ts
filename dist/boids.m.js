import{normalize as t,scale as i,create as e,set as s,add as o,limit as h,sub as r,sqrDist as a,len as n,lerp as c}from"gl-vec2";function p(e,s,o){return t(e,s),i(e,e,o),e}function l(t){return Math.atan2(t[1],t[0])}var d=function(){function l(t){this.acceleration=s(e(),0,0),this.velocity=s(e(),t.velocity[0],t.velocity[1]),this.oldVelocity=s(e(),t.velocity[0],t.velocity[1]),this.smoothVelocity=s(e(),t.velocity[0],t.velocity[1]),this.position=s(e(),t.center[0],t.center[1]),this.r=t.r||3,this.maxspeed=t.maxspeed||3,this.maxforce=t.maxforce||.05,this.width=t.canvasSize[0],this.height=t.canvasSize[1],this.separationScale=t.separationScale||1.5,this.alignScale=t.alignScale||1,this.cohesionScale=t.cohesionScale||1,this.desiredSeparation=Math.pow(t.desiredSeparation||25,2),this.neighborDistance=Math.pow(t.neighborDistance||50,2),this.arriveRadius=t.arriveRadius||100,this.desiredSeek=s(e(),0,0),this.steerSeek=s(e(),0,0),this.separateDiff=s(e(),0,0),this.steerSeparate=s(e(),0,0),this.sumCohesion=s(e(),0,0),this.sumAlign=s(e(),0,0)}return l.prototype.run=function(t,i){void 0===i&&(i=null),i?this.arrive(i):this.flock(t),this.update(),this.borders()},l.prototype.arrive=function(t){var i,s,a=r(e(),t,this.position),c=n(a);c<this.arriveRadius?p(a,a,(s=0)+(c-(i=0))/(this.arriveRadius-i)*(this.maxspeed-s)):p(a,a,this.maxspeed);var l=r(a,a,this.velocity);h(l,l,this.maxforce),o(this.acceleration,this.acceleration,l)},l.prototype.flock=function(t){s(this.oldVelocity,this.smoothVelocity[0],this.smoothVelocity[1]),s(this.sumCohesion,0,0),s(this.sumAlign,0,0);var e=this.separate(t),h=this.align(t),r=this.cohesion(t);i(e,e,this.separationScale),i(h,h,this.alignScale),i(r,r,this.cohesionScale),o(this.acceleration,this.acceleration,e),o(this.acceleration,this.acceleration,h),o(this.acceleration,this.acceleration,r)},l.prototype.update=function(){o(this.velocity,this.velocity,this.acceleration),h(this.velocity,this.velocity,this.maxspeed),o(this.position,this.position,this.velocity),i(this.acceleration,this.acceleration,0),c(this.smoothVelocity,this.oldVelocity,this.velocity,.1)},l.prototype.seek=function(e){return r(this.desiredSeek,e,this.position),t(this.desiredSeek,this.desiredSeek),i(this.desiredSeek,this.desiredSeek,this.maxspeed),r(this.steerSeek,this.desiredSeek,this.velocity),h(this.steerSeek,this.steerSeek,this.maxforce),this.steerSeek},l.prototype.borders=function(){this.position[0]<-this.r&&(this.position[0]=this.width+this.r),this.position[1]<-this.r&&(this.position[1]=this.height+this.r),this.position[0]>this.width+this.r&&(this.position[0]=-this.r),this.position[1]>this.height+this.r&&(this.position[1]=-this.r)},l.prototype.separate=function(e){var c=this.desiredSeparation;s(this.steerSeparate,0,0);for(var p=0,l=0;l<e.length;l++){var d=a(this.position,e[l].position);d>0&&d<c&&(r(this.separateDiff,this.position,e[l].position),t(this.separateDiff,this.separateDiff),i(this.separateDiff,this.separateDiff,1/d),o(this.steerSeparate,this.steerSeparate,this.separateDiff),p++)}return p>0&&i(this.steerSeparate,this.steerSeparate,1/p),n(this.steerSeparate)>0&&(t(this.steerSeparate,this.steerSeparate),i(this.steerSeparate,this.steerSeparate,this.maxspeed),r(this.steerSeparate,this.steerSeparate,this.velocity),h(this.steerSeparate,this.steerSeparate,this.maxforce)),this.steerSeparate},l.prototype.align=function(n){for(var c=this.neighborDistance,p=s(this.sumAlign,0,0),l=0,d=0;d<n.length;d++){var f=a(this.position,n[d].position);f>0&&f<c&&(o(p,p,n[d].velocity),l++)}if(l>0){i(p,p,1/l),t(p,p),i(p,p,this.maxspeed);var u=r(p,p,this.velocity);return h(u,u,this.maxforce),u}return s(e(),0,0)},l.prototype.cohesion=function(t){for(var h=this.neighborDistance,r=s(this.sumCohesion,0,0),n=0,c=0;c<t.length;c++){var p=a(this.position,t[c].position);p>0&&p<h&&(o(r,r,t[c].position),n++)}return n>0?(i(r,r,1/n),this.seek(r)):s(e(),0,0)},l}(),f=function(){function t(){this.boids=[]}return t.prototype.run=function(t){void 0===t&&(t=null);for(var i=0,e=this.boids;i<e.length;i++){e[i].run(this.boids,t)}},t.prototype.addBoid=function(t){this.boids.push(t)},t}();export{l as heading,d as Boid,f as Flock};
//# sourceMappingURL=boids.m.js.map
