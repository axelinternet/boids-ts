var t=require("gl-vec2");function e(e,i,s){return t.normalize(e,i),t.scale(e,e,s),e}var i=function(){function i(e){this.acceleration=t.set(t.create(),0,0),this.velocity=t.set(t.create(),e.velocity[0],e.velocity[1]),this.oldVelocity=t.set(t.create(),e.velocity[0],e.velocity[1]),this.smoothVelocity=t.set(t.create(),e.velocity[0],e.velocity[1]),this.position=t.set(t.create(),e.center[0],e.center[1]),this.r=e.r||3,this.maxspeed=e.maxspeed||3,this.maxforce=e.maxforce||.05,this.width=e.canvasSize[0],this.height=e.canvasSize[1],this.separationScale=e.separationScale||1.5,this.alignScale=e.alignScale||1,this.cohesionScale=e.cohesionScale||1,this.desiredSeparation=Math.pow(e.desiredSeparation||25,2),this.neighborDistance=Math.pow(e.neighborDistance||50,2),this.arriveRadius=e.arriveRadius||100,this.desiredSeek=t.set(t.create(),0,0),this.steerSeek=t.set(t.create(),0,0),this.separateDiff=t.set(t.create(),0,0),this.steerSeparate=t.set(t.create(),0,0),this.sumCohesion=t.set(t.create(),0,0),this.sumAlign=t.set(t.create(),0,0)}return i.prototype.run=function(t,e){void 0===e&&(e=null),e?this.arrive(e):this.flock(t),this.update(),this.borders()},i.prototype.arrive=function(i){var s,a,o=t.sub(t.create(),i,this.position),r=t.len(o);r<this.arriveRadius?e(o,o,(a=0)+(r-(s=0))/(this.arriveRadius-s)*(this.maxspeed-a)):e(o,o,this.maxspeed);var h=t.sub(o,o,this.velocity);t.limit(h,h,this.maxforce),t.add(this.acceleration,this.acceleration,h)},i.prototype.flock=function(e){t.set(this.oldVelocity,this.smoothVelocity[0],this.smoothVelocity[1]),t.set(this.sumCohesion,0,0),t.set(this.sumAlign,0,0);var i=this.separate(e),s=this.align(e),a=this.cohesion(e);t.scale(i,i,this.separationScale),t.scale(s,s,this.alignScale),t.scale(a,a,this.cohesionScale),t.add(this.acceleration,this.acceleration,i),t.add(this.acceleration,this.acceleration,s),t.add(this.acceleration,this.acceleration,a)},i.prototype.update=function(){t.add(this.velocity,this.velocity,this.acceleration),t.limit(this.velocity,this.velocity,this.maxspeed),t.add(this.position,this.position,this.velocity),t.scale(this.acceleration,this.acceleration,0),t.lerp(this.smoothVelocity,this.oldVelocity,this.velocity,.1)},i.prototype.seek=function(e){return t.sub(this.desiredSeek,e,this.position),t.normalize(this.desiredSeek,this.desiredSeek),t.scale(this.desiredSeek,this.desiredSeek,this.maxspeed),t.sub(this.steerSeek,this.desiredSeek,this.velocity),t.limit(this.steerSeek,this.steerSeek,this.maxforce),this.steerSeek},i.prototype.borders=function(){this.position[0]<-this.r&&(this.position[0]=this.width+this.r),this.position[1]<-this.r&&(this.position[1]=this.height+this.r),this.position[0]>this.width+this.r&&(this.position[0]=-this.r),this.position[1]>this.height+this.r&&(this.position[1]=-this.r)},i.prototype.separate=function(e){var i=this.desiredSeparation;t.set(this.steerSeparate,0,0);for(var s=0,a=0;a<e.length;a++){var o=t.sqrDist(this.position,e[a].position);o>0&&o<i&&(t.sub(this.separateDiff,this.position,e[a].position),t.normalize(this.separateDiff,this.separateDiff),t.scale(this.separateDiff,this.separateDiff,1/o),t.add(this.steerSeparate,this.steerSeparate,this.separateDiff),s++)}return s>0&&t.scale(this.steerSeparate,this.steerSeparate,1/s),t.len(this.steerSeparate)>0&&(t.normalize(this.steerSeparate,this.steerSeparate),t.scale(this.steerSeparate,this.steerSeparate,this.maxspeed),t.sub(this.steerSeparate,this.steerSeparate,this.velocity),t.limit(this.steerSeparate,this.steerSeparate,this.maxforce)),this.steerSeparate},i.prototype.align=function(e){for(var i=this.neighborDistance,s=t.set(this.sumAlign,0,0),a=0,o=0;o<e.length;o++){var r=t.sqrDist(this.position,e[o].position);r>0&&r<i&&(t.add(s,s,e[o].velocity),a++)}if(a>0){t.scale(s,s,1/a),t.normalize(s,s),t.scale(s,s,this.maxspeed);var h=t.sub(s,s,this.velocity);return t.limit(h,h,this.maxforce),h}return t.set(t.create(),0,0)},i.prototype.cohesion=function(e){for(var i=this.neighborDistance,s=t.set(this.sumCohesion,0,0),a=0,o=0;o<e.length;o++){var r=t.sqrDist(this.position,e[o].position);r>0&&r<i&&(t.add(s,s,e[o].position),a++)}return a>0?(t.scale(s,s,1/a),this.seek(s)):t.set(t.create(),0,0)},i}(),s=function(){function t(){this.boids=[]}return t.prototype.run=function(t){void 0===t&&(t=null);for(var e=0,i=this.boids;e<i.length;e++){i[e].run(this.boids,t)}},t.prototype.addBoid=function(t){this.boids.push(t)},t}();exports.heading=function(t){return Math.atan2(t[1],t[0])},exports.Boid=i,exports.Flock=s;
//# sourceMappingURL=boids.js.map
