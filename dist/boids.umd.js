!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gl-vec2")):"function"==typeof define&&define.amd?define(["exports","gl-vec2"],e):e(t.boidsTs={},t.glVec2)}(this,function(t,e){function i(t,i,s){return e.normalize(t,i),e.scale(t,t,s),t}var s=function(){function t(t){this.acceleration=e.set(e.create(),0,0),this.velocity=e.set(e.create(),t.velocity[0],t.velocity[1]),this.oldVelocity=e.set(e.create(),t.velocity[0],t.velocity[1]),this.smoothVelocity=e.set(e.create(),t.velocity[0],t.velocity[1]),this.position=e.set(e.create(),t.center[0],t.center[1]),this.r=t.r||3,this.maxspeed=t.maxspeed||3,this.maxforce=t.maxforce||.05,this.width=t.canvasSize[0],this.height=t.canvasSize[1],this.separationScale=t.separationScale||1.5,this.alignScale=t.alignScale||1,this.cohesionScale=t.cohesionScale||1,this.desiredSeparation=Math.pow(t.desiredSeparation||25,2),this.neighborDistance=Math.pow(t.neighborDistance||50,2),this.arriveRadius=t.arriveRadius||100,this.desiredSeek=e.set(e.create(),0,0),this.steerSeek=e.set(e.create(),0,0),this.separateDiff=e.set(e.create(),0,0),this.steerSeparate=e.set(e.create(),0,0),this.sumCohesion=e.set(e.create(),0,0),this.sumAlign=e.set(e.create(),0,0)}return t.prototype.run=function(t,e){void 0===e&&(e=null),e?this.arrive(e):this.flock(t),this.update(),this.borders()},t.prototype.arrive=function(t){var s,o,a=e.sub(e.create(),t,this.position),r=e.len(a);r<this.arriveRadius?i(a,a,(o=0)+(r-(s=0))/(this.arriveRadius-s)*(this.maxspeed-o)):i(a,a,this.maxspeed);var h=e.sub(a,a,this.velocity);e.limit(h,h,this.maxforce),e.add(this.acceleration,this.acceleration,h)},t.prototype.flock=function(t){e.set(this.oldVelocity,this.smoothVelocity[0],this.smoothVelocity[1]),e.set(this.sumCohesion,0,0),e.set(this.sumAlign,0,0);var i=this.separate(t),s=this.align(t),o=this.cohesion(t);e.scale(i,i,this.separationScale),e.scale(s,s,this.alignScale),e.scale(o,o,this.cohesionScale),e.add(this.acceleration,this.acceleration,i),e.add(this.acceleration,this.acceleration,s),e.add(this.acceleration,this.acceleration,o)},t.prototype.update=function(){e.add(this.velocity,this.velocity,this.acceleration),e.limit(this.velocity,this.velocity,this.maxspeed),e.add(this.position,this.position,this.velocity),e.scale(this.acceleration,this.acceleration,0),e.lerp(this.smoothVelocity,this.oldVelocity,this.velocity,.1)},t.prototype.seek=function(t){return e.sub(this.desiredSeek,t,this.position),e.normalize(this.desiredSeek,this.desiredSeek),e.scale(this.desiredSeek,this.desiredSeek,this.maxspeed),e.sub(this.steerSeek,this.desiredSeek,this.velocity),e.limit(this.steerSeek,this.steerSeek,this.maxforce),this.steerSeek},t.prototype.borders=function(){this.position[0]<-this.r&&(this.position[0]=this.width+this.r),this.position[1]<-this.r&&(this.position[1]=this.height+this.r),this.position[0]>this.width+this.r&&(this.position[0]=-this.r),this.position[1]>this.height+this.r&&(this.position[1]=-this.r)},t.prototype.separate=function(t){var i=this.desiredSeparation;e.set(this.steerSeparate,0,0);for(var s=0,o=0;o<t.length;o++){var a=e.sqrDist(this.position,t[o].position);a>0&&a<i&&(e.sub(this.separateDiff,this.position,t[o].position),e.normalize(this.separateDiff,this.separateDiff),e.scale(this.separateDiff,this.separateDiff,1/a),e.add(this.steerSeparate,this.steerSeparate,this.separateDiff),s++)}return s>0&&e.scale(this.steerSeparate,this.steerSeparate,1/s),e.len(this.steerSeparate)>0&&(e.normalize(this.steerSeparate,this.steerSeparate),e.scale(this.steerSeparate,this.steerSeparate,this.maxspeed),e.sub(this.steerSeparate,this.steerSeparate,this.velocity),e.limit(this.steerSeparate,this.steerSeparate,this.maxforce)),this.steerSeparate},t.prototype.align=function(t){for(var i=this.neighborDistance,s=e.set(this.sumAlign,0,0),o=0,a=0;a<t.length;a++){var r=e.sqrDist(this.position,t[a].position);r>0&&r<i&&(e.add(s,s,t[a].velocity),o++)}if(o>0){e.scale(s,s,1/o),e.normalize(s,s),e.scale(s,s,this.maxspeed);var h=e.sub(s,s,this.velocity);return e.limit(h,h,this.maxforce),h}return e.set(e.create(),0,0)},t.prototype.cohesion=function(t){for(var i=this.neighborDistance,s=e.set(this.sumCohesion,0,0),o=0,a=0;a<t.length;a++){var r=e.sqrDist(this.position,t[a].position);r>0&&r<i&&(e.add(s,s,t[a].position),o++)}return o>0?(e.scale(s,s,1/o),this.seek(s)):e.set(e.create(),0,0)},t}(),o=function(){function t(){this.boids=[]}return t.prototype.run=function(t){void 0===t&&(t=null);for(var e=0,i=this.boids;e<i.length;e++){i[e].run(this.boids,t)}},t.prototype.addBoid=function(t){this.boids.push(t)},t}();t.heading=function(t){return Math.atan2(t[1],t[0])},t.Boid=s,t.Flock=o});
//# sourceMappingURL=boids.umd.js.map
